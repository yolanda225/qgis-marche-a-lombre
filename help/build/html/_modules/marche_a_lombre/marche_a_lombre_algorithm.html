<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>marche_a_lombre.marche_a_lombre_algorithm &#8212; MarcheALOmbre 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=514cf933" />
    
    <script src="../../_static/documentation_options.js?v=2709fde1"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MarcheALOmbre 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../marche_a_lombre.html" accesskey="U">marche_a_lombre</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">marche_a_lombre.marche_a_lombre_algorithm</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for marche_a_lombre.marche_a_lombre_algorithm</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># /***************************************************************************</span>
<span class="c1">#  MarcheALOmbre</span>
<span class="c1">#                                  A QGIS plugin</span>
<span class="c1">#  This plugin calculates for a given hike the shady and sunny parts</span>
<span class="c1">#  Generated by Plugin Builder: http://g-sherman.github.io/Qgis-Plugin-Builder/</span>
<span class="c1">#                               -------------------</span>
<span class="c1">#         begin                : 2025-12-11</span>
<span class="c1">#         copyright            : (C) 2025 by Yolanda Seifert</span>
<span class="c1">#         email                : yolanda.seifert@gmx.de</span>
<span class="c1">#  ***************************************************************************/</span>

<span class="c1"># /***************************************************************************</span>
<span class="c1">#  *                                                                         *</span>
<span class="c1">#  *   This program is free software; you can redistribute it and/or modify  *</span>
<span class="c1">#  *   it under the terms of the GNU General Public License as published by  *</span>
<span class="c1">#  *   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="c1">#  *   (at your option) any later version.                                   *</span>
<span class="c1">#  *                                                                         *</span>
<span class="c1">#  ***************************************************************************/</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Yolanda Seifert&#39;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s1">&#39;2025-12-11&#39;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s1">&#39;(C) 2025 by Yolanda Seifert&#39;</span>

<span class="c1"># This will get replaced with a git SHA1 when you do a git archive</span>

<span class="n">__revision__</span> <span class="o">=</span> <span class="s1">&#39;$Format:%H$&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span>
<span class="kn">from</span> <span class="nn">qgis.PyQt.QtGui</span> <span class="kn">import</span> <span class="n">QIcon</span>
<span class="kn">from</span> <span class="nn">qgis.PyQt.QtCore</span> <span class="kn">import</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">QMetaType</span>
<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QgsProcessing</span><span class="p">,</span>
                        <span class="n">QgsFeatureSink</span><span class="p">,</span>
                        <span class="n">QgsProcessingAlgorithm</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterDateTime</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterNumber</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterPoint</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterBoolean</span><span class="p">,</span>
                        <span class="n">QgsPoint</span><span class="p">,</span>
                        <span class="n">QgsProcessingException</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterRasterDestination</span><span class="p">,</span>
                        <span class="n">QgsProcessingParameterFileDestination</span><span class="p">,</span>
                        <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span>
                        <span class="n">QgsFields</span><span class="p">,</span>
                        <span class="n">QgsWkbTypes</span><span class="p">,</span>
                        <span class="n">QgsFeature</span><span class="p">,</span>
                        <span class="n">QgsGeometry</span><span class="p">,</span>
                        <span class="n">QgsField</span><span class="p">,</span>
                        <span class="n">QgsProcessingUtils</span><span class="p">,</span>
                        <span class="n">QgsCategorizedSymbolRenderer</span><span class="p">,</span>
                        <span class="n">QgsRendererCategory</span><span class="p">,</span>
                        <span class="n">QgsSymbol</span><span class="p">,</span>
                        <span class="n">QgsSimpleMarkerSymbolLayer</span><span class="p">,</span>
                        <span class="n">QgsVectorLayer</span><span class="p">,</span>
                        <span class="n">QgsProperty</span><span class="p">,</span>
                        <span class="n">QgsSymbolLayer</span><span class="p">)</span>


<span class="kn">from</span> <span class="nn">.mns_downloader</span> <span class="kn">import</span> <span class="n">MNSDownloader</span>
<span class="kn">from</span> <span class="nn">.trail</span> <span class="kn">import</span> <span class="n">Trail</span>
<span class="kn">from</span> <span class="nn">.shadow_calculator</span> <span class="kn">import</span> <span class="n">ShadowCalculator</span>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm">[docs]</a>
<span class="k">class</span> <span class="nc">MarcheALOmbreAlgorithm</span><span class="p">(</span><span class="n">QgsProcessingAlgorithm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is an example algorithm that takes a vector layer and</span>
<span class="sd">    creates a new identical one.</span>

<span class="sd">    It is meant to be used as an example of how to create your own</span>
<span class="sd">    algorithms and explain methods and variables used to do it. An</span>
<span class="sd">    algorithm like this will be available in all elements, and there</span>
<span class="sd">    is not need for additional work.</span>

<span class="sd">    All Processing algorithms should extend the QgsProcessingAlgorithm</span>
<span class="sd">    class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Constants used to refer to parameters and outputs. They will be</span>
    <span class="c1"># used when calling the algorithm from another algorithm, or when</span>
    <span class="c1"># calling from the QGIS console.</span>

    <span class="n">OUTPUT</span> <span class="o">=</span> <span class="s1">&#39;OUTPUT&#39;</span>
    <span class="n">INPUT</span> <span class="o">=</span> <span class="s1">&#39;INPUT&#39;</span>
    <span class="n">DEPARTURE_TIME</span> <span class="o">=</span> <span class="s1">&#39;DEPARTURE_TIME&#39;</span>
    <span class="n">HIKING_SPEED</span> <span class="o">=</span> <span class="s1">&#39;HIKING_SPEED&#39;</span>
    <span class="n">ADJUST_FOR_SLOPE</span> <span class="o">=</span> <span class="s1">&#39;ADJUST_FOR_SLOPE&#39;</span>
    <span class="n">PICNIC_POINT</span> <span class="o">=</span> <span class="s1">&#39;PICNIC_POINT&#39;</span>
    <span class="n">PICNIC_DURATION</span> <span class="o">=</span> <span class="s1">&#39;PICNIC_DURATION&#39;</span>
    <span class="n">REVERSE_DIRECTION</span> <span class="o">=</span> <span class="s1">&#39;REVERSE_DIRECTION&#39;</span>
    <span class="n">BUFFER_MODE</span> <span class="o">=</span> <span class="s1">&#39;BUFFER_MODE&#39;</span>
    <span class="n">OUTPUT_POINTS</span> <span class="o">=</span> <span class="s1">&#39;OUTPUT_POINTS&#39;</span>
    <span class="n">LOW_RES_MNS</span> <span class="o">=</span> <span class="s1">&#39;LOW_RES_MNS&#39;</span>
    <span class="n">OUTPUT_CSV</span> <span class="o">=</span> <span class="s1">&#39;OUTPUT_CSV&#39;</span>

<div class="viewcode-block" id="MarcheALOmbreAlgorithm.initAlgorithm">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.initAlgorithm">[docs]</a>
    <span class="k">def</span> <span class="nf">initAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here we define the inputs and output of the algorithm, along</span>
<span class="sd">        with some other properties.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># We add the input vector features source. It can have any kind of</span>
        <span class="c1"># geometry.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSource</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Input layer - tracks&#39;</span><span class="p">),</span>
                <span class="p">[</span><span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorAnyGeometry</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterDateTime</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">DEPARTURE_TIME</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Departure Date and Time (Local Time)&#39;</span><span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">QgsProcessingParameterDateTime</span><span class="o">.</span><span class="n">DateTime</span>  <span class="c1"># Allows selecting both Date and Time</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterNumber</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">HIKING_SPEED</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Average Hiking Speed (km/h)&#39;</span><span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">QgsProcessingParameterNumber</span><span class="o">.</span><span class="n">Double</span><span class="p">,</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>  <span class="c1"># A standard hiking speed</span>
                <span class="n">minValue</span><span class="o">=</span><span class="mf">0.0</span> 
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterBoolean</span><span class="p">(</span>
                <span class="s1">&#39;ADJUST_FOR_SLOPE&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Adjust hiking speed for slope (recommended for mountainous regions)&#39;</span><span class="p">),</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterPoint</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PICNIC_POINT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Picnic Break Location (1h stop)&#39;</span><span class="p">),</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Optional: user might not want a break</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterNumber</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PICNIC_DURATION</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Picnic Duration (minutes)&#39;</span><span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">QgsProcessingParameterNumber</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                <span class="n">minValue</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">optional</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterBoolean</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">REVERSE_DIRECTION</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Reverse Trail Direction (Finish to Start)&#39;</span><span class="p">),</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterBoolean</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">BUFFER_MODE</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Calculate with Buffer (Center, Left 5m, Right 5m)&#39;</span><span class="p">),</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFeatureSink</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_POINTS</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Densified Trail Points&#39;</span><span class="p">),</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">QgsProcessing</span><span class="o">.</span><span class="n">TypeVectorPoint</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterRasterDestination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">LOW_RES_MNS</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Low Resolution MNS (15m)&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterRasterDestination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;High Resolution MNS (0.5m)&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">addParameter</span><span class="p">(</span>
            <span class="n">QgsProcessingParameterFileDestination</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_CSV</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s1">&#39;Statistics Table&#39;</span><span class="p">),</span>
                <span class="n">fileFilter</span><span class="o">=</span><span class="s1">&#39;CSV files (*.csv)&#39;</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.processAlgorithm">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.processAlgorithm">[docs]</a>
    <span class="k">def</span> <span class="nf">processAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Here is where the processing itself takes place.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Retrieve the feature source and sink. The &#39;dest_id&#39; variable is used</span>
        <span class="c1"># to uniquely identify the feature sink, and must be included in the</span>
        <span class="c1"># dictionary returned by the processAlgorithm function.</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSource</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">INPUT</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">departure_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsDateTime</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEPARTURE_TIME</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">speed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsDouble</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">HIKING_SPEED</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">adjust_for_slope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsBool</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="s1">&#39;ADJUST_FOR_SLOPE&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> 
        <span class="n">picnic_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsPoint</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PICNIC_POINT</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">picnic_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsDouble</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PICNIC_DURATION</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">picnic_point_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsPointCrs</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">PICNIC_POINT</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">reverse_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsBool</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">REVERSE_DIRECTION</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">buffer_mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsBool</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BUFFER_MODE</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">csv_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsFileOutput</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_CSV</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">picnic_point</span> <span class="ow">or</span> <span class="p">(</span><span class="n">picnic_point</span><span class="o">.</span><span class="n">x</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">picnic_point</span><span class="o">.</span><span class="n">y</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="n">picnic_point_crs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Compute the number of steps to display within the progress bar and</span>
        <span class="c1"># get features from source</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="o">/</span> <span class="n">source</span><span class="o">.</span><span class="n">featureCount</span><span class="p">()</span> <span class="k">if</span> <span class="n">source</span><span class="o">.</span><span class="n">featureCount</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getFeatures</span><span class="p">()</span>

        <span class="c1">########################## TRAIL PROCESSING #########################</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s2">&quot;Processing trail...&quot;</span><span class="p">)</span>
        <span class="n">source_crs</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">sourceCrs</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_crs</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">QgsProcessingException</span><span class="p">(</span>
                <span class="s2">&quot;Input layer has no valid CRS. Please define the layer CRS before running this algorithm.&quot;</span>
            <span class="p">)</span>

        <span class="n">trail</span> <span class="o">=</span> <span class="n">Trail</span><span class="p">(</span>
            <span class="n">max_sep</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">speed</span><span class="o">=</span><span class="n">speed</span><span class="p">,</span> 
            <span class="n">source_crs</span><span class="o">=</span><span class="n">source_crs</span><span class="p">,</span>
            <span class="n">transform_context</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">transformContext</span><span class="p">(),</span>
            <span class="n">feedback</span><span class="o">=</span><span class="n">feedback</span>
        <span class="p">)</span>
        <span class="n">trail</span><span class="o">.</span><span class="n">process_trail</span><span class="p">(</span><span class="n">source_tracks</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> 
                            <span class="n">start_time</span><span class="o">=</span><span class="n">departure_dt</span><span class="p">,</span> 
                            <span class="n">break_point</span><span class="o">=</span><span class="n">picnic_point</span><span class="p">,</span> 
                            <span class="n">picnic_duration</span><span class="o">=</span><span class="n">picnic_duration</span><span class="p">,</span>
                            <span class="n">reverse</span><span class="o">=</span><span class="n">reverse_direction</span><span class="p">,</span>
                            <span class="n">buffer</span><span class="o">=</span><span class="n">buffer_mode</span><span class="p">,</span>
                            <span class="n">project_crs</span><span class="o">=</span><span class="n">picnic_point_crs</span><span class="p">,</span>
                            <span class="n">adjust_for_slope</span><span class="o">=</span><span class="n">adjust_for_slope</span><span class="p">)</span>

        <span class="c1">########################## MNT DOWNLOAD (For Z Values) ##################</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Digital Terrain Model (MNT) from IGN...&quot;</span><span class="p">)</span>
        <span class="c1"># Generate a temporary file path for the MNT</span>
        <span class="n">mnt_path</span> <span class="o">=</span> <span class="n">QgsProcessingUtils</span><span class="o">.</span><span class="n">generateTempFilename</span><span class="p">(</span><span class="s1">&#39;mnt_elevation.tif&#39;</span><span class="p">)</span>
        <span class="n">target_crs</span> <span class="o">=</span> <span class="n">trail</span><span class="o">.</span><span class="n">target_crs</span>
        <span class="n">downloader</span> <span class="o">=</span> <span class="n">MNSDownloader</span><span class="p">(</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">,</span> 
            <span class="n">transform_context</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">transformContext</span><span class="p">(),</span> 
            <span class="n">feedback</span><span class="o">=</span><span class="n">feedback</span><span class="p">)</span>
        <span class="n">target_resolution</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="c1"># Download MNT (mns=False)</span>
        <span class="n">success_mnt</span> <span class="o">=</span> <span class="n">downloader</span><span class="o">.</span><span class="n">read_tif</span><span class="p">(</span>
            <span class="n">extent</span><span class="o">=</span><span class="n">trail</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">target_resolution</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># less variation in trail elevation so lower resolution necessary</span>
            <span class="n">output_path</span><span class="o">=</span><span class="n">mnt_path</span><span class="p">,</span>
            <span class="n">input_crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">,</span>
            <span class="n">is_mns</span><span class="o">=</span><span class="kc">False</span>  
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">success_mnt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QgsProcessingException</span><span class="p">(</span><span class="s2">&quot;Failed to download MNT data.&quot;</span><span class="p">)</span>
        
        <span class="c1"># Integrate MNT into Trail (Sample Z values)</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s2">&quot;Using MNT for trail point elevation values...&quot;</span><span class="p">)</span>
        <span class="n">trail</span><span class="o">.</span><span class="n">sample_elevation</span><span class="p">(</span><span class="n">mnt_path</span><span class="p">,</span> <span class="n">departure_dt</span><span class="p">,</span> <span class="n">buffer_mode</span><span class="p">)</span>

        <span class="c1">########################## MNS DOWNLOAD (for Shade) ############################</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Download Digital Surface Model (MNS) from IGN...&quot;</span><span class="p">)</span>
        <span class="n">output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsOutputLayer</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">low_res_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsOutputLayer</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">LOW_RES_MNS</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        
        <span class="n">downloader</span> <span class="o">=</span> <span class="n">MNSDownloader</span><span class="p">(</span>
            <span class="n">crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">,</span>
            <span class="n">transform_context</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">transformContext</span><span class="p">(),</span> 
            <span class="n">feedback</span><span class="o">=</span><span class="n">feedback</span><span class="p">)</span>

        <span class="n">downloader</span><span class="o">.</span><span class="n">download_dual_quality_mns</span><span class="p">(</span>
            <span class="n">trail_extent</span><span class="o">=</span><span class="n">trail</span><span class="o">.</span><span class="n">extent</span><span class="p">,</span>
            <span class="n">high_res_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
            <span class="n">low_res_path</span><span class="o">=</span><span class="n">low_res_path</span><span class="p">,</span>
            <span class="n">trail_lat</span><span class="o">=</span><span class="n">trail</span><span class="o">.</span><span class="n">center_lat</span><span class="p">,</span>
            <span class="n">input_crs</span><span class="o">=</span><span class="n">target_crs</span><span class="p">,</span>
            <span class="n">high_res</span><span class="o">=</span><span class="n">target_resolution</span><span class="p">,</span> <span class="c1"># meters per pixel</span>
        <span class="p">)</span>
        
        <span class="c1"># Open MNS raster with GDAL</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QgsProcessingException</span><span class="p">(</span><span class="s2">&quot;Could not open downloaded MNS.&quot;</span><span class="p">)</span>
            
        <span class="n">mns_band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mns_array</span> <span class="o">=</span> <span class="n">mns_band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span> <span class="c1"># Returns numpy array</span>
        <span class="n">geo_transform</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
            
        <span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Close dataset</span>

        <span class="c1">########################## CALCULATE SHADOWS ############################</span>
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s2">&quot;Calculating shadows...&quot;</span><span class="p">)</span>
 
        <span class="n">calculator</span> <span class="o">=</span> <span class="n">ShadowCalculator</span><span class="p">(</span>
            <span class="n">high_res_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
            <span class="n">low_res_path</span><span class="o">=</span><span class="n">low_res_path</span>
        <span class="p">)</span>
        
        <span class="n">shadow_results</span> <span class="o">=</span> <span class="n">calculator</span><span class="o">.</span><span class="n">calculate_shadows</span><span class="p">(</span>
            <span class="n">trail_points</span><span class="o">=</span><span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">,</span>
            <span class="n">max_dist_m</span><span class="o">=</span><span class="mi">20000</span>
        <span class="p">)</span>

        <span class="c1">########################## CALCULATE STATISTICS ############################</span>
        <span class="n">total_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shadow_results</span><span class="p">)</span>
        <span class="n">shady_points</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">shadow_results</span><span class="p">)</span>
        <span class="n">sunny_points</span> <span class="o">=</span> <span class="n">total_points</span> <span class="o">-</span> <span class="n">shady_points</span>
        
        <span class="n">percent_shady</span> <span class="o">=</span> <span class="p">(</span><span class="n">shady_points</span> <span class="o">/</span> <span class="n">total_points</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_points</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="n">percent_sunny</span> <span class="o">=</span> <span class="p">(</span><span class="n">sunny_points</span> <span class="o">/</span> <span class="n">total_points</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_points</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Statistics: </span><span class="si">{</span><span class="n">percent_shady</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% Shady, </span><span class="si">{</span><span class="n">percent_sunny</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% Sunny&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">csv_path</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">csv_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># Header</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Duration (min), % Shady, % Sunny, Time spent in Shadow (min), Time spent in Sun (min), Shady Points, Sunny Points, Total Points</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    
                    <span class="n">duration_min</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">:</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
                        <span class="n">end</span> <span class="o">=</span> <span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">datetime</span>
                        <span class="n">duration_min</span> <span class="o">=</span> <span class="n">start</span><span class="o">.</span><span class="n">secsTo</span><span class="p">(</span><span class="n">end</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
                    <span class="n">time_shady</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration_min</span><span class="o">*</span><span class="n">percent_shady</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
                    <span class="n">time_sunny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration_min</span><span class="o">*</span><span class="n">percent_sunny</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">duration_min</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">percent_shady</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">percent_sunny</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">time_shady</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">time_sunny</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">shady_points</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sunny_points</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">total_points</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">feedback</span><span class="o">.</span><span class="n">reportError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write CSV: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1">########################## WRITE OUTPUT POINTS ##########################</span>
        <span class="c1"># Define attribute table columns</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">QgsFields</span><span class="p">()</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Int</span><span class="p">))</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">QString</span><span class="p">))</span>    <span class="c1"># Sunny / Shady</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;is_shadow&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Int</span><span class="p">))</span>     <span class="c1"># 0 / 1</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;x_proj&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>     <span class="c1"># Lambert-93 X</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;y_proj&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>     <span class="c1"># Lambert-93 Y</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;z_mnt&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>      <span class="c1"># Altitude</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>   <span class="c1"># WGS84 Lat</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>  <span class="c1"># WGS84 Lon</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;arrival_time&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">QDateTime</span><span class="p">))</span> <span class="c1"># Time</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;elevation_deg&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span> <span class="c1"># Sun elevation angle</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;azimuth_deg&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span> <span class="c1"># Sun azimtuh angle</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsField</span><span class="p">(</span><span class="s2">&quot;course&quot;</span><span class="p">,</span> <span class="n">QMetaType</span><span class="o">.</span><span class="n">Double</span><span class="p">))</span>

        <span class="p">(</span><span class="n">point_sink</span><span class="p">,</span> <span class="n">point_dest_id</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameterAsSink</span><span class="p">(</span>
            <span class="n">parameters</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_POINTS</span><span class="p">,</span> 
            <span class="n">context</span><span class="p">,</span> 
            <span class="n">fields</span><span class="p">,</span> 
            <span class="n">QgsWkbTypes</span><span class="o">.</span><span class="n">PointZ</span><span class="p">,</span>
            <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="n">target_crs</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_dest_id</span> <span class="o">=</span> <span class="n">point_dest_id</span>

        <span class="k">if</span> <span class="n">point_sink</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QgsProcessingException</span><span class="p">(</span><span class="s2">&quot;Could not create point sink&quot;</span><span class="p">)</span>
        
        <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="s2">&quot;Writing results...&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">feedback</span><span class="o">.</span><span class="n">isCanceled</span><span class="p">():</span> <span class="k">break</span>

            <span class="c1"># Calculate direction to next point for visualization</span>
            <span class="n">course</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">next_tp</span> <span class="o">=</span> <span class="n">trail</span><span class="o">.</span><span class="n">trail_points</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">course</span> <span class="o">=</span> <span class="n">QgsPoint</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tp</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">azimuth</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">next_tp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">next_tp</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">course</span> <span class="o">=</span> <span class="n">prev_course</span>
            <span class="n">prev_course</span> <span class="o">=</span> <span class="n">course</span>

            <span class="n">feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">geom</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">tp</span><span class="o">.</span><span class="n">z</span><span class="p">))</span>
            <span class="n">feat</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
            
            <span class="n">is_shadow</span> <span class="o">=</span> <span class="n">shadow_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">status_str</span> <span class="o">=</span> <span class="s2">&quot;Shadow&quot;</span> <span class="k">if</span> <span class="n">is_shadow</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;Sun&quot;</span>
            
            <span class="n">feat</span><span class="o">.</span><span class="n">setAttributes</span><span class="p">([</span>
                <span class="n">i</span><span class="p">,</span>
                <span class="n">status_str</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">is_shadow</span><span class="p">),</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span>
                <span class="n">tp</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span>
                <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">solar_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">tp</span><span class="o">.</span><span class="n">solar_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">course</span>
            <span class="p">])</span>
            <span class="n">point_sink</span><span class="o">.</span><span class="n">addFeature</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">QgsFeatureSink</span><span class="o">.</span><span class="n">FastInsert</span><span class="p">)</span>
            <span class="n">feedback</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">total</span><span class="p">))</span>

        <span class="c1"># Return the results of the algorithm. In this case our only result is</span>
        <span class="c1"># the feature sink which contains the processed features, but some</span>
        <span class="c1"># algorithms may return multiple feature sinks, calculated numeric</span>
        <span class="c1"># statistics, etc. These should all be included in the returned</span>
        <span class="c1"># dictionary, with keys matching the feature corresponding parameter</span>
        <span class="c1"># or output names.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT</span><span class="p">:</span> <span class="n">output_path</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_POINTS</span><span class="p">:</span> <span class="n">point_dest_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LOW_RES_MNS</span><span class="p">:</span> <span class="n">low_res_path</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_CSV</span><span class="p">:</span> <span class="n">csv_path</span><span class="p">,</span>
            <span class="s1">&#39;detected_crs&#39;</span><span class="p">:</span> <span class="n">target_crs</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span></div>

    
<div class="viewcode-block" id="MarcheALOmbreAlgorithm.postProcessAlgorithm">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.postProcessAlgorithm">[docs]</a>
    <span class="k">def</span> <span class="nf">postProcessAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">feedback</span><span class="p">):</span>
        <span class="c1"># Set project CRS to match the detected region</span>
        <span class="n">detected_crs_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;detected_crs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detected_crs_str</span><span class="p">:</span>
            <span class="n">detected_crs</span> <span class="o">=</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="n">detected_crs_str</span><span class="p">)</span>
            <span class="n">project</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">detected_crs</span><span class="o">.</span><span class="n">isValid</span><span class="p">()</span> <span class="ow">and</span> <span class="n">project</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span> <span class="o">!=</span> <span class="n">detected_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">():</span>
                <span class="n">feedback</span><span class="o">.</span><span class="n">pushInfo</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Changing project CRS from </span><span class="si">{</span><span class="n">project</span><span class="o">.</span><span class="n">crs</span><span class="p">()</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">detected_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="si">}</span><span class="s2"> to match detected region&quot;</span><span class="p">)</span>
                <span class="n">project</span><span class="o">.</span><span class="n">setCrs</span><span class="p">(</span><span class="n">detected_crs</span><span class="p">)</span>
        <span class="c1"># style the output trail depending on Sun/Shadow</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">QgsProcessingUtils</span><span class="o">.</span><span class="n">mapLayerFromString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">point_dest_id</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">layer</span><span class="p">:</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">styles</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Sun&quot;</span><span class="p">,</span> <span class="s2">&quot;gold&quot;</span><span class="p">),</span> 
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Shadow&quot;</span><span class="p">,</span> <span class="s2">&quot;#1f78b4&quot;</span><span class="p">)</span> 
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">styles</span><span class="p">:</span>
                <span class="n">sym_layer</span> <span class="o">=</span> <span class="n">QgsSimpleMarkerSymbolLayer</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
                    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;filled_arrowhead&#39;</span><span class="p">,</span> 
                    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                    <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="s1">&#39;2.5&#39;</span><span class="p">,</span>
                <span class="p">})</span>

                <span class="c1"># Direction of arrow based on course field</span>
                <span class="n">prop_angle</span> <span class="o">=</span> <span class="n">QgsProperty</span><span class="o">.</span><span class="n">fromExpression</span><span class="p">(</span><span class="s1">&#39;&quot;course&quot; - 90&#39;</span><span class="p">)</span>
                <span class="n">sym_layer</span><span class="o">.</span><span class="n">setDataDefinedProperty</span><span class="p">(</span><span class="n">QgsSymbolLayer</span><span class="o">.</span><span class="n">PropertyAngle</span><span class="p">,</span> <span class="n">prop_angle</span><span class="p">)</span>

                <span class="n">sym</span> <span class="o">=</span> <span class="n">QgsSymbol</span><span class="o">.</span><span class="n">defaultSymbol</span><span class="p">(</span><span class="n">layer</span><span class="o">.</span><span class="n">geometryType</span><span class="p">())</span>
                <span class="n">sym</span><span class="o">.</span><span class="n">changeSymbolLayer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sym_layer</span><span class="p">)</span>
                <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QgsRendererCategory</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

            <span class="n">renderer</span> <span class="o">=</span> <span class="n">QgsCategorizedSymbolRenderer</span><span class="p">(</span><span class="s2">&quot;is_shadow&quot;</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">setRenderer</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
            <span class="n">layer</span><span class="o">.</span><span class="n">triggerRepaint</span><span class="p">()</span>

        <span class="n">csv_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTPUT_CSV</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">csv_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
            <span class="c1"># Create delimited text layer from csv</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">csv_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;file:///</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">?type=csv&amp;watchFile=no&quot;</span>
            
            <span class="n">vlayer</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="s2">&quot;Shadow Statistics&quot;</span><span class="p">,</span> <span class="s2">&quot;delimitedtext&quot;</span><span class="p">)</span>  
            <span class="k">if</span> <span class="n">vlayer</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                <span class="n">context</span><span class="o">.</span><span class="n">project</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">vlayer</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span></div>

    
<div class="viewcode-block" id="MarcheALOmbreAlgorithm.helpUrl">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.helpUrl">[docs]</a>
    <span class="k">def</span> <span class="nf">helpUrl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the URL to the help page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cmd_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">help_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_folder</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">help_path</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;file://&quot;</span> <span class="o">+</span> <span class="n">help_path</span>
        
        <span class="c1"># Fallback if local help isn&#39;t built yet</span>
        <span class="k">return</span> <span class="s2">&quot;https://github.com/yolanda225/qgis-marche-a-lombre&quot;</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.shortHelpString">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.shortHelpString">[docs]</a>
    <span class="k">def</span> <span class="nf">shortHelpString</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a brief description of the algorithm</span>
<span class="sd">        (appears in the right-hand panel of the dialog)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;This algorithm calculates the shady and sunny portions of a trail &quot;</span>
                       <span class="s2">&quot;based on LiDAR HD data (MNS) and the sun&#39;s position at the time &quot;</span>
                       <span class="s2">&quot;you are physically at each point on the hike.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.name">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.name">[docs]</a>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the algorithm name, used for identifying the algorithm. This</span>
<span class="sd">        string should be fixed for the algorithm, and must not be localised.</span>
<span class="sd">        The name should be unique within each provider. Names should contain</span>
<span class="sd">        lowercase alphanumeric characters only and no spaces or other</span>
<span class="sd">        formatting characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;marche_a_lombre&quot;</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.displayName">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.displayName">[docs]</a>
    <span class="k">def</span> <span class="nf">displayName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the translated algorithm name, which should be used for any</span>
<span class="sd">        user-visible display of the algorithm name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">())</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.group">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.group">[docs]</a>
    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the name of the group this algorithm belongs to. This string</span>
<span class="sd">        should be localised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groupId</span><span class="p">())</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.groupId">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.groupId">[docs]</a>
    <span class="k">def</span> <span class="nf">groupId</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the unique ID of the group this algorithm belongs to. This</span>
<span class="sd">        string should be fixed for the algorithm, and must not be localised.</span>
<span class="sd">        The group id should be unique within each provider. Group id should</span>
<span class="sd">        contain lowercase alphanumeric characters only and no spaces or other</span>
<span class="sd">        formatting characters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>


<div class="viewcode-block" id="MarcheALOmbreAlgorithm.tr">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.tr">[docs]</a>
    <span class="k">def</span> <span class="nf">tr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;Processing&#39;</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="MarcheALOmbreAlgorithm.icon">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.icon">[docs]</a>
    <span class="k">def</span> <span class="nf">icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd_folder</span><span class="p">,</span> <span class="s1">&#39;logo.png&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">icon</span></div>

    
<div class="viewcode-block" id="MarcheALOmbreAlgorithm.createInstance">
<a class="viewcode-back" href="../../api/marche_a_lombre.html#marche_a_lombre.marche_a_lombre_algorithm.MarcheALOmbreAlgorithm.createInstance">[docs]</a>
    <span class="k">def</span> <span class="nf">createInstance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MarcheALOmbreAlgorithm</span><span class="p">()</span></div>
</div>

    
    
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">MarcheALOmbre 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../marche_a_lombre.html" >marche_a_lombre</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">marche_a_lombre.marche_a_lombre_algorithm</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2013, Yolanda Seifert.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>